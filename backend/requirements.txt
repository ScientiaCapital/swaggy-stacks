# ================================================================================
# SWAGGY STACKS - IRON-CLAD REQUIREMENTS.TXT
# ================================================================================
# Comprehensive dependency specification with Python version fallbacks
# Supports Python 3.7+ through Python 3.13+ with proper version constraints
# ================================================================================

# Core Framework - FastAPI with version compatibility
fastapi>=0.103.2,<0.116.0  # Python 3.7+ compatible, avoid bleeding edge
uvicorn[standard]>=0.24.0,<0.33.0
pydantic>=1.10.12,<3.0.0  # Broad compatibility range
pydantic-settings>=2.0.0,<3.0.0; python_version>="3.8"
pydantic-settings>=1.1.0,<2.0.0; python_version<"3.8"

# Database - Stable versions with broad compatibility
sqlalchemy>=1.4.48,<2.1.0  # Support both 1.4 and 2.x branches
alembic>=1.12.0,<1.15.0
psycopg2-binary>=2.9.5,<2.10.0
psycopg2>=2.9.5,<2.10.0  # Fallback for systems without binary wheels
redis>=4.5.0,<6.0.0

# Python Standard Library Backports for older Python versions
typing-extensions>=4.5.0,<5.0.0
importlib-metadata>=4.0.0,<7.0.0; python_version<"3.8"
backports.zoneinfo>=0.2.1; python_version<"3.9"

# Async and Concurrency
asyncio>=3.4.3; python_version<"3.7"
aiofiles>=23.0.0,<24.0.0
aiosmtplib>=2.0.0,<3.0.0
async-timeout>=4.0.0,<5.0.0; python_version<"3.11"

# Ollama Client and AI Integration - CRITICAL FOR AGENT INITIALIZATION
ollama>=0.1.7,<1.0.0
httpx>=0.24.0,<0.28.0  # Required by ollama client - relaxed for compatibility
h11>=0.14.0,<0.15.0    # HTTP/1.1 implementation
h2>=4.1.0,<5.0.0       # HTTP/2 implementation

# AI Agent Framework - DeepAgents + LangGraph
anthropic>=0.40.0,<1.0.0
langgraph>=1.0.0,<2.0.0
langchain>=1.0.0,<2.0.0
langchain-core>=1.0.0,<2.0.0
langchain-anthropic>=1.0.0,<2.0.0
langchain-community>=0.3.0,<0.4.0  # Note: 1.0.0 not released yet, using stable 0.3.x

# Additional AI Providers
openai>=1.0.0,<2.0.0  # For OpenRouter multi-model access
# cerebras>=0.1.0,<1.0.0  # Commented - may not have PyPI package yet, use via OpenRouter

# State Management & Persistence
langgraph-checkpoint>=2.1.0,<4.0.0  # Required by langgraph 1.0.x
langgraph-checkpoint-postgres>=2.0.0,<3.0.0

# DeepAgents - AI Agent Framework
deepagents>=0.1.0,<0.2.0

# PydanticAI - Type-safe AI Agents with Validation
pydantic-ai>=0.0.13,<0.1.0  # Latest stable version for type-safe agents
pydantic-ai-slim>=0.0.13,<0.1.0  # Minimal version without heavy dependencies

# Trading & Market Data - Battle-tested versions
alpaca-trade-api>=3.1.0,<3.2.0
yfinance>=0.2.20,<0.3.0
pandas>=1.5.0,<2.3.0  # Broad compatibility
numpy>=1.21.0,<1.25.0; python_version<"3.9"
numpy>=1.21.0,<2.0.0; python_version>="3.9"

# Technical Analysis (requires system install: brew install ta-lib on macOS)
# TA-Lib>=0.4.25,<0.5.0  # Preferred binary version (optional, requires system library)
# talib>=0.4.25,<0.5.0   # Alternative package name (optional, requires system library)
ta>=0.10.2,<0.11.0     # Pure Python fallback (no system dependencies required)

# Scientific Computing - Version constraints for stability
scipy>=1.11.0,<1.15.0  # Python 3.13 requires scipy 1.11+
scikit-learn>=1.1.0,<1.6.0
matplotlib>=3.5.0,<4.0.0
seaborn>=0.11.0,<0.14.0

# Machine Learning - Controlled versions
torch>=2.6.0,<3.0.0; python_version>="3.13"  # Python 3.13 requires PyTorch 2.6+
torch>=1.13.0,<2.2.0; python_version>="3.8" and python_version<"3.13"
torch>=1.13.0,<1.14.0; python_version<"3.8"  # Older PyTorch for Python 3.7
transformers>=4.25.0,<4.37.0
datasets>=2.10.0,<2.16.0

# MLX Framework for Apple Silicon - Optional with fallback
mlx>=0.19.3,<1.0.0; platform_machine=="arm64" and sys_platform=="darwin"
mlx-lm>=0.19.0,<1.0.0; platform_machine=="arm64" and sys_platform=="darwin"

# Vector Storage and Embeddings - Stable versions
sentence-transformers>=2.2.0,<3.0.0
faiss-cpu>=1.9.0,<2.0.0  # Python 3.13 requires faiss-cpu 1.9+
chromadb>=0.4.15,<0.6.0
pgvector>=0.2.3,<0.4.0

# Background Tasks and Message Queues
celery>=5.2.0,<5.4.0
kombu>=5.2.0,<5.4.0  # Celery dependency
billiard>=3.6.0,<4.2.0  # Celery dependency

# Authentication & Security - Security-focused versions
python-jose[cryptography]>=3.3.0,<3.4.0
PyJWT>=2.8.0,<2.9.0  # JWT token handling for NATS security
passlib[bcrypt]>=1.7.4,<1.8.0
bcrypt>=4.0.0,<4.1.0
cryptography>=41.0.0,<42.0.0
python-multipart>=0.0.6,<0.1.0

# HTTP & API - Stable networking stack
requests>=2.28.0,<2.32.0
urllib3>=1.26.0,<2.1.0
certifi>=2022.12.7
charset-normalizer>=3.0.0,<4.0.0

# WebSocket Support - Real-time communication
websockets>=11.0.0,<13.0.0
python-socketio>=5.8.0,<6.0.0
python-engineio>=4.7.0,<5.0.0

# NATS Client - Ultra-low latency messaging
nats-py>=2.6.0,<2.8.0

# Monitoring & Logging - Production-ready observability
prometheus-client>=0.17.0,<0.22.0
structlog>=23.0.0,<25.0.0  # CRITICAL - This was causing import errors
sentry-sdk[fastapi]>=1.32.0,<2.0.0
loguru>=0.7.0,<0.8.0  # Alternative logging solution

# Configuration and Environment
python-dotenv>=1.0.0,<1.1.0
pyyaml>=6.0.0,<6.1.0
toml>=0.10.2,<0.11.0

# Development & Testing - Comprehensive test suite
pytest>=7.4.0,<8.0.0
pytest-asyncio>=0.21.0,<0.22.0
pytest-cov>=4.1.0,<5.0.0
pytest-mock>=3.11.0,<4.0.0
pytest-xdist>=3.3.0,<4.0.0  # Parallel test execution
pytest-timeout>=2.1.0,<3.0.0

# Code Quality and Formatting
black>=23.9.0,<24.0.0
isort>=5.12.0,<5.13.0
flake8>=6.0.0,<7.0.0
mypy>=1.5.0,<1.8.0
pre-commit>=3.4.0,<4.0.0

# CLI and User Interface
click>=8.1.0,<8.2.0
rich>=13.5.0,<14.0.0
colorama>=0.4.6,<0.5.0
tqdm>=4.65.0,<5.0.0

# Date and Time Handling
python-dateutil>=2.8.2,<2.9.0
pytz>=2023.3,<2024.0

# JSON and Data Serialization
orjson>=3.9.0,<3.10.0  # Fast JSON library
msgpack>=1.0.5,<1.1.0
pickle5>=0.0.12; python_version<"3.8"  # Backport for Python 3.7

# Validation and Parsing
email-validator>=2.0.0,<2.1.0
phonenumbers>=8.13.0,<8.14.0
validators>=0.22.0,<0.23.0

# Caching and Performance
cachetools>=5.3.0,<5.4.0
diskcache>=5.6.0,<5.7.0
lru-dict>=1.2.0,<1.3.0

# Development Utilities
ipython>=8.10.0,<8.16.0; python_version>="3.8"
ipython>=7.34.0,<8.0.0; python_version<"3.8"
jupyter>=1.0.0,<2.0.0  # For development notebooks
notebook>=6.5.0,<7.0.0

# Optional GPU Support (for development machines with CUDA)
torch-audio>=0.13.0,<0.14.0; extra == "gpu"
torch-vision>=0.14.0,<0.15.0; extra == "gpu"

# ================================================================================
# CRITICAL NOTES FOR DEPLOYMENT:
# ================================================================================
# 1. This requirements.txt is designed for maximum compatibility
# 2. Version ranges allow for security updates while preventing breaking changes
# 3. Python version constraints ensure compatibility from 3.7 to 3.13+
# 4. Fallback packages are included for systems without binary wheels
# 5. All dependencies required for agent initialization are included
# 6. Use 'pip install -r requirements.txt --upgrade-strategy only-if-needed'
# 7. For production, consider pinning exact versions after testing
# ================================================================================
